# POSIX Shell Server Hardening Toolkit - Configuration
# Generated by Ansible on {{ ansible_date_time.iso8601 }}
# Host: {{ inventory_hostname }}

# ============================================================================
# SAFETY SETTINGS - CRITICAL FOR REMOTE SERVERS
# ============================================================================

SAFETY_MODE={{ safety_mode }}
DRY_RUN={{ dry_run }}
BACKUP_BEFORE_CHANGE={{ backup_before_change }}
ROLLBACK_ENABLED={{ rollback_enabled }}
FAIL_FAST={{ fail_fast }}
VERBOSE={{ verbose }}

# ============================================================================
# SSH CONFIGURATION
# ============================================================================

SSH_PORT={{ ssh_port | default(ansible_port, true) | default(22) }}
ADMIN_IP="{{ admin_ip }}"
SSHD_TEST_PORT={{ ssh_test_port }}
SSH_ROLLBACK_TIMEOUT={{ ssh_rollback_timeout }}
SSH_TEST_TIMEOUT=10

{% if ssh_allow_users %}
SSH_ALLOW_USERS="{{ ssh_allow_users }}"
{% endif %}

{% if ssh_allow_groups %}
SSH_ALLOW_GROUPS="{{ ssh_allow_groups }}"
{% endif %}

# ============================================================================
# FIREWALL CONFIGURATION
# ============================================================================

ENABLE_FIREWALL={{ enable_firewall | int }}
FIREWALL_TIMEOUT={{ firewall_timeout }}

{% if allowed_ports %}
ALLOWED_PORTS="{{ allowed_ports | join(' ') }}"
{% endif %}

{% if trusted_networks %}
TRUSTED_NETWORKS="{{ trusted_networks | join(' ') }}"
{% endif %}

# ============================================================================
# SYSTEM PATHS
# ============================================================================

BACKUP_DIR="{{ backup_path }}"
LOG_DIR="{{ log_path }}"
STATE_DIR="{{ state_path }}"
BACKUP_RETENTION_DAYS={{ backup_retention_days | default(30) }}

# ============================================================================
# KERNEL AND SYSTEM HARDENING
# ============================================================================

ENABLE_KERNEL_HARDENING={{ enable_kernel_hardening | int }}
ENABLE_NETWORK_HARDENING={{ enable_network_hardening | int }}
ENABLE_PROCESS_LIMITS={{ enable_process_limits | int }}
MAX_USER_PROCESSES={{ max_user_processes }}
CORE_DUMP_LIMIT={{ core_dump_limit }}

# ============================================================================
# FILE PERMISSIONS
# ============================================================================

ENABLE_FILE_PERMISSIONS={{ enable_file_permissions | int }}
SYSTEM_UMASK={{ system_umask }}
USER_UMASK={{ user_umask }}

# ============================================================================
# PASSWORD AND AUTHENTICATION
# ============================================================================

PASSWORD_MIN_LENGTH={{ password_min_length }}
PASSWORD_MAX_AGE={{ password_max_age }}
PASSWORD_WARN_AGE={{ password_warn_age }}
ACCOUNT_LOCKOUT_THRESHOLD={{ account_lockout_threshold }}
ACCOUNT_LOCKOUT_DURATION={{ account_lockout_duration }}

# ============================================================================
# LOGGING AND AUDITING
# ============================================================================

ENABLE_AUDIT_LOGGING={{ enable_audit_logging | int }}
LOG_RETENTION_DAYS={{ log_retention_days }}
AUDIT_LOG="{{ audit_log }}"

# ============================================================================
# SERVICE HARDENING
# ============================================================================

{% if disable_services %}
DISABLE_SERVICES="{{ disable_services | join(' ') }}"
{% endif %}

{% if required_services %}
REQUIRED_SERVICES="{{ required_services | join(' ') }}"
{% endif %}

# ============================================================================
# MOUNT OPTIONS
# ============================================================================

ENABLE_MOUNT_HARDENING={{ enable_mount_hardening | int }}
TMP_DIRS="{{ tmp_dirs | join(' ') }}"
TMP_MOUNT_OPTIONS="{{ tmp_mount_options }}"

# ============================================================================
# SHELL TIMEOUT
# ============================================================================

SHELL_TIMEOUT={{ shell_timeout }}

# ============================================================================
# INTEGRITY CHECKING
# ============================================================================

ENABLE_INTEGRITY_CHECK={{ enable_integrity_check | int }}
INTEGRITY_DIRS="{{ integrity_dirs | join(' ') }}"

# ============================================================================
# EMERGENCY ACCESS
# ============================================================================

EMERGENCY_SSH_PORT={{ emergency_ssh_port }}
ENABLE_EMERGENCY_ACCESS={{ enable_emergency_ssh | int }}

# ============================================================================
# TESTING AND VALIDATION
# ============================================================================

RUN_VALIDATION={{ run_validation | int }}
TEST_MODE={{ test_mode }}

# ============================================================================
# ANSIBLE DEPLOYMENT INFO
# ============================================================================

# Deployed by: {{ ansible_user }}
# Deployment date: {{ ansible_date_time.iso8601 }}
# Ansible version: {{ ansible_version.full }}