# POSIX Firewall Configuration
# Generated by Ansible - Manual edits may be overwritten
# Template: ansible/templates/firewall.conf.j2

# ============================================================================
# BASIC FIREWALL SETTINGS
# ============================================================================

FIREWALL_ENABLED={{ firewall_enabled | default(1) }}
FIREWALL_MODE="{{ firewall_mode | default('strict') }}"

# ============================================================================
# SSH BRUTE-FORCE PROTECTION
# ============================================================================

SSH_RATE_LIMIT_ENABLED={{ ssh_rate_limit_enabled | default(1) }}
SSH_RATE_LIMIT_HITS={{ ssh_rate_limit_hits | default(4) }}
SSH_RATE_LIMIT_SECONDS={{ ssh_rate_limit_seconds | default(60) }}

# ============================================================================
# ICMP (PING) SETTINGS
# ============================================================================

ICMP_ENABLED={{ icmp_enabled | default(1) }}
ICMP_RATE_LIMIT="{{ icmp_rate_limit | default('1/s') }}"
ICMP_TYPES="{{ icmp_types | default('echo-request echo-reply destination-unreachable time-exceeded') }}"

# ============================================================================
# FIREWALL LOGGING
# ============================================================================

LOG_DROPPED_PACKETS={{ log_dropped_packets | default(1) }}
LOG_RATE_LIMIT="{{ log_rate_limit | default('2/min') }}"
LOG_PREFIX="{{ log_prefix | default('IPTables-Dropped: ') }}"
LOG_LEVEL={{ log_level | default(4) }}

# ============================================================================
# OUTBOUND TRAFFIC RULES
# ============================================================================

ALLOW_DNS={{ allow_dns | default(1) }}
ALLOW_NTP={{ allow_ntp | default(1) }}
ALLOW_HTTP={{ allow_http | default(1) }}
ALLOW_HTTPS={{ allow_https | default(1) }}
CUSTOM_OUTBOUND_TCP="{{ custom_outbound_tcp | default('') }}"
CUSTOM_OUTBOUND_UDP="{{ custom_outbound_udp | default('') }}"

# ============================================================================
# DEFAULT POLICIES
# ============================================================================

DEFAULT_INPUT_POLICY="{{ default_input_policy | default('DROP') }}"
DEFAULT_FORWARD_POLICY="{{ default_forward_policy | default('DROP') }}"
DEFAULT_OUTPUT_POLICY="{{ default_output_policy | default('ACCEPT') }}"

# ============================================================================
# IPv6 CONFIGURATION
# ============================================================================

IPV6_ENABLED={{ ipv6_enabled | default(1) }}
IPV6_MODE="{{ ipv6_mode | default('same') }}"

# ============================================================================
# CUSTOM IPTABLES RULES
# ============================================================================

{% if custom_rules_ipv4 is defined and custom_rules_ipv4 %}
CUSTOM_RULES_IPV4="{{ custom_rules_ipv4 }}"
{% else %}
CUSTOM_RULES_IPV4=""
{% endif %}

{% if custom_rules_ipv6 is defined and custom_rules_ipv6 %}
CUSTOM_RULES_IPV6="{{ custom_rules_ipv6 }}"
{% else %}
CUSTOM_RULES_IPV6=""
{% endif %}

{% if custom_chains is defined and custom_chains %}
CUSTOM_CHAINS="{{ custom_chains }}"
{% else %}
CUSTOM_CHAINS=""
{% endif %}

# ============================================================================
# DEPLOYMENT INFO
# ============================================================================
# Deployed by: Ansible
# Template: ansible/templates/firewall.conf.j2
# Date: {{ ansible_date_time.iso8601 }}
# Host: {{ inventory_hostname }}
