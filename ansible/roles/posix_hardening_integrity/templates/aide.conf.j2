# {{ ansible_managed }}
# ==============================================================================
# AIDE Configuration File
# ==============================================================================
# Generated by: posix_hardening_integrity role
# Advanced Intrusion Detection Environment
# ==============================================================================

# Database and report locations
database=file:{{ posix_integrity_aide_db }}
database_out=file:{{ posix_integrity_aide_db_new }}
database_new=file:{{ posix_integrity_aide_db_new }}

# Report location
report_url=file:{{ posix_integrity_report_file }}
{% if posix_integrity_enable_syslog | bool %}
report_url=syslog:LOG_LOCAL0
{% endif %}

# Gzip databases
{% if posix_integrity_gzip_database | bool %}
gzip_dbout=yes
{% endif %}

# Report format
{% if posix_integrity_report_format == 'html' %}
report_format=html
{% else %}
report_format=plain
{% endif %}

# ==============================================================================
# AIDE RULES
# ==============================================================================
# Rule definitions for different file types
# p     = permissions
# i     = inode
# n     = number of links
# u     = user
# g     = group
# s     = size
# b     = block count
# m     = mtime
# a     = atime
# c     = ctime
# S     = check for growing size
# sha256 = SHA256 hash

# Custom rules
BINARIES = {{ posix_integrity_rule_binaries }}
CONFIGS = {{ posix_integrity_rule_configs }}
LOGS = {{ posix_integrity_rule_logs }}
DATABASES = {{ posix_integrity_rule_databases }}

# Standard AIDE rules
FIPSR = p+i+n+u+g+s+m+c+sha256
NORMAL = p+i+n+u+g+s+m+c+sha256
DIR = p+i+n+u+g
PERMS = p+u+g

# ==============================================================================
# EXCLUSIONS
# ==============================================================================
# Directories to exclude from monitoring

{% for exclude in posix_integrity_exclude_dirs %}
!{{ exclude }}
{% endfor %}

{% for exclude in posix_integrity_custom_excludes %}
!{{ exclude }}
{% endfor %}

# ==============================================================================
# MONITORING RULES
# ==============================================================================
# Define what to monitor and with which rules

# System binaries
{% if posix_integrity_monitor_bin | bool %}
/bin BINARIES
{% endif %}

{% if posix_integrity_monitor_sbin | bool %}
/sbin BINARIES
{% endif %}

{% if posix_integrity_monitor_usr_bin | bool %}
/usr/bin BINARIES
{% endif %}

{% if posix_integrity_monitor_usr_sbin | bool %}
/usr/sbin BINARIES
{% endif %}

# System libraries
{% if posix_integrity_monitor_lib | bool %}
/lib BINARIES
/lib64 BINARIES
/usr/lib BINARIES
/usr/lib64 BINARIES
{% endif %}

# System configuration
{% if posix_integrity_monitor_etc | bool %}
/etc CONFIGS
{% endif %}

# Boot files
{% if posix_integrity_monitor_boot | bool %}
/boot BINARIES
{% endif %}

# Root directory
{% if posix_integrity_monitor_root | bool %}
/root CONFIGS
{% endif %}

# Optional directories
{% if posix_integrity_monitor_opt | bool %}
/opt BINARIES
{% endif %}

{% if posix_integrity_monitor_home | bool %}
/home CONFIGS
{% endif %}

# Custom directories
{% for custom_dir in posix_integrity_custom_dirs %}
{{ custom_dir }} CONFIGS
{% endfor %}

# ==============================================================================
# SPECIFIC FILE MONITORING
# ==============================================================================
# Monitor critical individual files

# Authentication files
/etc/passwd CONFIGS
/etc/shadow CONFIGS
/etc/group CONFIGS
/etc/gshadow CONFIGS

# SSH configuration
/etc/ssh/sshd_config CONFIGS

# Sudo configuration
/etc/sudoers CONFIGS
/etc/sudoers.d CONFIGS

# PAM configuration
/etc/pam.d CONFIGS

# System initialization
/etc/init.d CONFIGS
/etc/systemd CONFIGS

# Cron configuration
/etc/crontab CONFIGS
/etc/cron.d CONFIGS
